# Математическая база

## 1. Постановка задачи

Рассмотрим двумерное эллиптическое уравнение в области $\Omega \subset \mathbb{R}^2$:

$$
-\nabla \cdot (\lambda(x, y) \nabla u) + \gamma(x, y) u = f(x, y),
$$

где:
- $u(x, y)$ — искомая функция,
- $\lambda(x, y)$ — коэффициент теплопроводности,
- $\gamma(x, y)$ — коэффициент теплоотдачи,
- $f(x, y)$ — правая часть уравнения.

### Краевые условия
1. **Условие Дирихле** (первого рода):
   $$
   u = g(x, y) \quad \text{на} \quad \Gamma_D.
   $$
2. **Условие Неймана** (второго рода):
   $$
   \frac{\partial u}{\partial n} = h(x, y) \quad \text{на} \quad \Gamma_N.
   $$
3. **Условие Робин** (третьего рода):
   $$
   \frac{\partial u}{\partial n} + \beta(x, y) u = q(x, y) \quad \text{на} \quad \Gamma_R.
   $$

Здесь $\Gamma_D$, $\Gamma_N$, $\Gamma_R$ — части границы $\partial\Omega$, где заданы соответствующие краевые условия.

---

## 2. Метод конечных элементов (МКЭ)

### 2.1. Аппроксимация решения
Решение $u(x, y)$ аппроксимируется с помощью базисных функций $\phi_i(x, y)$:

$$
u(x, y) \approx \sum_{i=1}^{N} u_i \phi_i(x, y),
$$

где:
- $u_i$ — значения функции в узлах сетки,
- $N$ — количество узлов,
- $\phi_i(x, y)$ — базисные функции.

### 2.2. Базисные функции
Для биквадратичных базисных функций на прямоугольных элементах, каждая функция $\phi_i(x, y)$ определена на 9 узлах элемента. Базисные функции строятся как произведение одномерных квадратичных функций:

$$
\phi_i(x, y) = \psi_{i_x}(x) \cdot \psi_{i_y}(y),
$$

где $\psi_{i_x}(x)$ и $\psi_{i_y}(y)$ — квадратичные функции, определенные на отрезке $[-1, 1]$.

---

## 3. Дискретизация уравнения

### 3.1. Слабая форма уравнения
Умножим исходное уравнение на тестовую функцию $v(x, y)$ и проинтегрируем по области $\Omega$:

$$
\int_\Omega \left( -\nabla \cdot (\lambda \nabla u) + \gamma u \right) v \, d\Omega = \int_\Omega f v \, d\Omega.
$$

После интегрирования по частям получаем слабую форму:

$$
\int_\Omega \lambda \nabla u \cdot \nabla v \, d\Omega + \int_\Omega \gamma u v \, d\Omega = \int_\Omega f v \, d\Omega + \int_{\partial\Omega} \lambda \frac{\partial u}{\partial n} v \, d\Gamma.
$$

### 3.2. Локальные матрицы и векторы
Для каждого конечного элемента $e$ вычисляются локальные матрицы жесткости $\mathbf{K}_e$ и массы $\mathbf{M}_e$, а также локальный вектор правой части $\mathbf{f}_e$:

$$
\mathbf{K}_e = \int_{e} \lambda \nabla \phi_i \cdot \nabla \phi_j \, d\Omega,
$$

$$
\mathbf{M}_e = \int_{e} \gamma \phi_i \phi_j \, d\Omega,
$$

$$
\mathbf{f}_e = \int_{e} f \phi_i \, d\Omega.
$$

### 3.3. Глобальная система
Глобальная матрица жесткости $\mathbf{K}$ и вектор правой части $\mathbf{f}$ формируются путем суммирования вкладов от всех элементов:

$$
\mathbf{K} = \sum_{e} \mathbf{K}_e, \quad \mathbf{f} = \sum_{e} \mathbf{f}_e.
$$

---

## 4. Учет краевых условий

### 4.1. Условие Дирихле
Значения функции в узлах на границе $\Gamma_D$ фиксируются:

$$
u_i = g(x_i, y_i) \quad \text{для} \quad i \in \Gamma_D.
$$

### 4.2. Условие Неймана
Вклад от граничных интегралов добавляется в правую часть:

$$
\mathbf{f}_i = \mathbf{f}_i + \int_{\Gamma_N} h \phi_i \, d\Gamma.
$$

### 4.3. Условие Робин
Вклад от граничных интегралов добавляется в матрицу жесткости и правую часть:

$$
\mathbf{K}_{ij} = \mathbf{K}_{ij} + \int_{\Gamma_R} \beta \phi_i \phi_j \, d\Gamma,
$$

$$
\mathbf{f}_i = \mathbf{f}_i + \int_{\Gamma_R} q \phi_i \, d\Gamma.
$$

---

## 5. Решение системы линейных уравнений

Система линейных уравнений имеет вид:

$$
\mathbf{K} \mathbf{u} = \mathbf{f}.
$$

Для решения используются итерационные методы:
- **Метод сопряжённых градиентов (МСГ)**:
  $$
  \mathbf{u}_{k+1} = \mathbf{u}_k + \alpha_k \mathbf{p}_k,
  $$
  где $\alpha_k$ — шаг, $\mathbf{p}_k$ — направление спуска.

- **Метод ЛОС с неполной факторизацией**:
  $$
  \mathbf{K} \approx \mathbf{L} \mathbf{D} \mathbf{L}^T,
  $$
  где $\mathbf{L}$ — нижняя треугольная матрица, $\mathbf{D}$ — диагональная матрица.

---

## 6. Алгоритм работы программы

1. **Загрузка данных**:
   - Загрузка сетки из файла `st.txt`.
   - Загрузка краевых условий из файлов `ku1.txt`, `ku2.txt`, `ku3.txt`.

2. **Сборка системы**:
   - Формирование локальных матриц жесткости и векторов правой части для каждого элемента.
   - Сборка глобальной матрицы жесткости и вектора правой части.

3. **Учет краевых условий**:
   - Применение условий Дирихле, Неймана и Робин к глобальной системе.

4. **Решение системы**:
   - Решение СЛАУ методом сопряжённых градиентов или методом ЛОС.

5. **Сохранение результата**:
   - Запись решения в файл `q.txt`.

---

## 7. Основные формулы

### 7.1. Локальные матрицы
- Матрица жесткости:
  $$
  \mathbf{K}_e = \int_{e} \lambda \nabla \phi_i \cdot \nabla \phi_j \, d\Omega.
  $$
- Матрица массы:
  $$
  \mathbf{M}_e = \int_{e} \gamma \phi_i \phi_j \, d\Omega.
  $$
- Вектор правой части:
  $$
  \mathbf{f}_e = \int_{e} f \phi_i \, d\Omega.
  $$

### 7.2. Глобальная система
$$
\mathbf{K} = \sum_{e} \mathbf{K}_e, \quad \mathbf{f} = \sum_{e} \mathbf{f}_e.
$$

### 7.3. Учет краевых условий
- Условие Дирихле:
  $$
  u_i = g(x_i, y_i).
  $$
- Условие Неймана:
  $$
  \mathbf{f}_i = \mathbf{f}_i + \int_{\Gamma_N} h \phi_i \, d\Gamma.
  $$
- Условие Робин:
  $$
  \mathbf{K}_{ij} = \mathbf{K}_{ij} + \int_{\Gamma_R} \beta \phi_i \phi_j \, d\Gamma,
  $$

  $$
  \mathbf{f}_i = \mathbf{f}_i + \int_{\Gamma_R} q \phi_i \, d\Gamma.
  $$

---